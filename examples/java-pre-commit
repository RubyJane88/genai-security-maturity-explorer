#!/bin/bash
# Pre-commit hook for Java/Maven projects
# Save as: .git/hooks/pre-commit

set -e

echo "üîç Running pre-commit checks for Java/Maven project..."
echo ""

# Check Java version
echo "1Ô∏è‚É£  Checking Java version..."
JAVA_VERSION=$(java -version 2>&1 | head -n 1 | awk -F '"' '{print $2}')
echo "   Current: Java $JAVA_VERSION"

REQUIRED_MAJOR="11"
CURRENT_MAJOR=$(echo $JAVA_VERSION | cut -d. -f1)

if [ "$CURRENT_MAJOR" -ge "$REQUIRED_MAJOR" ]; then
    echo "   ‚úÖ Java $CURRENT_MAJOR >= $REQUIRED_MAJOR"
else
    echo "   ‚ùå Java $CURRENT_MAJOR < $REQUIRED_MAJOR (required)"
    exit 1
fi
echo ""

# Check for pom.xml
echo "2Ô∏è‚É£  Checking pom.xml..."
if [ -f "pom.xml" ]; then
    echo "   ‚úÖ pom.xml found"
else
    echo "   ‚ùå pom.xml not found"
    exit 1
fi
echo ""

# Compile project
echo "3Ô∏è‚É£  Compiling project..."
mvn compile -q > /dev/null 2>&1
if [ $? -eq 0 ]; then
    echo "   ‚úÖ Compilation successful"
else
    echo "   ‚ùå Compilation failed"
    mvn compile
    exit 1
fi
echo ""

# Run tests
echo "4Ô∏è‚É£  Running tests..."
mvn test -q > /dev/null 2>&1
if [ $? -eq 0 ]; then
    echo "   ‚úÖ All tests passed"
else
    echo "   ‚ùå Tests failed"
    mvn test
    exit 1
fi
echo ""

# Check code style (if Checkstyle plugin exists)
echo "5Ô∏è‚É£  Checking code style..."
if grep -q "maven-checkstyle-plugin" pom.xml; then
    mvn checkstyle:check -q > /dev/null 2>&1
    if [ $? -eq 0 ]; then
        echo "   ‚úÖ No style violations"
    else
        echo "   ‚ö†Ô∏è  Style violations found"
        mvn checkstyle:check
    fi
else
    echo "   ‚ö†Ô∏è  Checkstyle plugin not configured (skipped)"
fi
echo ""

echo "‚úÖ All pre-commit checks passed!"
exit 0
